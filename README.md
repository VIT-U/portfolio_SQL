# Портфолио по анализу данных с использованием SQL.
> Репозиторий содержит проект, выполненный во время прохождения курса по анализу данных.

**1 часть.**

**1 запрос - Вывести ТОП- 3 аптеки по объему продаж.**

Решение:

Используем группировку по всем аптекам и с помощью агрегирующей функции находим суммарные продажи для каждой аптеки за все время. Продажи считаем по формуле «стоимость лекарства * проданное кол-во». Сортируем все аптеки по продажам по убыванию и оставляем только три первых аптеки.

Вывод:

На первом месте по продажам аптека «Cтоличная» с суммарной выручкой – 1,896,483 у.е., на втором месте аптека «Доктор Айболит» - 1,893,776 у.е. и третье место аптека «Здравсити» - 1,863,037 у.е.

**2 запрос - Вывести ТОП- 3 лекарств по объему продаж.**

Решение:

Используем группировку по лекарствам и с помощью агрегирующей функции находим суммарные продажи за все время. Продажи считаем по формуле «стоимость лекарства * проданное кол-во». Сортируем все лекарства по продажам по убыванию и оставляем только три лекарства с самыми высокими продажами.

Вывод:

На первом месте по продажам лекарство «Ибупрофен» с суммарной выручкой – 777,548 у.е., на втором месте лекарство «Цитрамон» - 776,332 у.е. и третье место лекарство «Аквафорте» - 771,579 у.е.

**3 запрос - Вывести аптеки, имеющие более 1.8 млн оборота.**

Решение:

Используем группировку по всем аптекам и с помощью агрегирующей функции находим суммарные продажи для каждой аптеки за все время. Продажи считаем по формуле «стоимость лекарства * проданное кол-во». Для агрегирующей функции задаем фильтр, чтобы в запросе остались только аптеки с продажами более 1.8 млн. Сортируем все аптеки по продажам.

Вывод:

Результат получаем аналогичный первому запросу, только три аптеки имеют общий оборот более 1.8 млн, они же ТОП-3 аптеки из первого запроса.

**4 запрос - Вывести накопительную сумму продаж по каждой аптеке.**

Решение:

В запросе оставляем поля с названием аптек и датой заказа. С помощью оконной функции рассчитываем дневные продажи внутри каждой аптеки, чтобы увидеть эффект накопления сортируем внутри оконной функции продажи по датам по возрастанию. И сортируем сам запрос по аптекам и датам продаж, чтобы наглядно видеть как растут продажи.

Вывод:

С помощью полученных данных можно проследить по каждой аптеки как меняется сумма продаж с каждым днем.

**5 запрос - Вывести количество уникальных клиентов в каждой аптеке.**

Решение:

Используем группировку по всем аптекам и с помощью агрегирующей функции находим количество клиентов в каждой аптеке, чтобы посчитать только уникальных клиентов используем метод «DISTINCT». Сортируем аптеки по количеству клиентов в убывающем порядке.

Вывод:

Количество клиентов в разных аптеках различается не сильно. Больше всего клиентов посещает аптеку «Cтоличная» - 441 клиент, меньше всего клиентов в аптеке «Горздрав» - 426 клиентов.

**6 запрос – Вывести ТОП-10 лучших клиентов.**

Решение:

Используем группировку по клиентам, оставляя в запросе поля с ID клиента, его именем, фамилией и отчеством. С помощью агрегирующей функции находим суммарные покупки каждого клиента за все время. С помощью оконной функции ранжируем их по сумме покупок начиная с самых больших и оставляем только первых 10 клиентов. Сортируем итоговый запрос по сумме покупок в убывающем порядке.

Вывод:

Мы получили самых прибыльных клиентов, для которых можно проводить дополнительные бонусные программы. На первом месте клиент сделавший покупок на 45,174 у.е., на десятом месте клиент с покупками на 38,406 у.е.

**7 запрос - Вывести накопительную сумму продаж по клиентам.**

Решение:

В запросе оставляем поля с идентификатором клиента, датой заказа и его именем, фамилией и отчеством, которые мы объединим в одно поле с помощью функции «CONCAT». С помощью оконной функции рассчитываем дневные продажи для каждого клиента, чтобы увидеть эффект накопления сортируем внутри оконной функции продажи по датам по возрастанию. И сортируем сам запрос по идентификатору клиента и датам продаж, чтобы наглядно видеть как суммируются продажи у каждого клиента при следующей покупки.

Вывод:

С помощью полученных данных можно проследить по каждому клиенту как меняется его сумма покупок с каждым днем.

**8 запрос - Вывести лучших клиентов по количеству заказов в аптеках 'Горздрав' и 'Здравсити'.**

Решение:

Для этого запроса будем использовать временные табличные выражения (СТЕ). В первом табличном выражении найдем ТОП-10 клиентов по количеству заказов из аптеки 'Горздрав' по аналогии с 6 запросом. Во втором табличном выражении найдем ТОП-10 клиентов из аптеки 'Здравсити'. В этих выражениях оставим по 4 одинаковых поля с названием аптеки, идентификатором клиента, его именем, фамилией и отчеством и агрегируемое поле с общим количеством продаж по каждому клиенту. В итоговом запросе соединим эти таблицы с помощью оператора «UNION». И сортируем итоговый запрос по аптеке и количеству заказов.

Вывод:

С помощью полученных данных можно видеть клиентов, которые чаще других совершают заказы в наших аптеках и проводить для них дополнительные бонусные программы.

**Часть 2.**

**1 запрос - Сравнить продажи между Москвой и Санкт-Петербургом по одинаковым аптекам.**

Решение:

Для этого запроса будем использовать временные табличные выражения (СТЕ). В первом табличном выражении считаем для Москвы суммарные продажи по месяцам для каждой аптеки, использую группировку по аптекам и месяцам. Перед этим каждую дату усекаем до месяца с помощью функции «DATE_TRUNC», чтобы группировка происходила не по дням, а именно по месяцу. Во втором табличном выражении делаем ту же процедуру, но только для города Санкт-Петербург. Чтобы выводить данные по конкретному городу используем фильтрацию. В итоговом запросе соединяем эти таблицы с помощью оператора «JOIN» и внутри соединения прописываем условия, чтобы соединение прошло по одинаковым аптекам и месяцам. В итоговом запросе рассчитываем процентную разницу по продажам относительно Москвы, чтобы наглядно видеть на сколько меньше или больше продажи в Санкт-Петербурге относительно Москвы. Сортируем итоговый запрос по аптеке и месяцу продаж.

Вывод:

В аптеках "Столичная" и "Здравсити" в феврале больше продаж в Санкт-Петербурге, но в остальные месяца преобладают продажи в Москве. Так же в аптеке "Горздрав" суммарные продажи в трех месяцах из четырех в Санкт-Петербурге меньше, чем в Москве. По остальным аптекам процентная разница показывает, что объемы продаж в Санкт-Петербурге больше, чем в Москве в большинстве месяцев.

**2 запрос – Изучить продажи лекарств в названии которых присутствует слово "аква".**

Решение:

Сначала во временном табличном выражении (СТЕ) создадим выборку интересующих нас лекарств, для этого в фильтрации применим метод «LIKE '%аква%'», чтобы оставить только лекарства содержащие в своем названии подстроку «аква». Потом сгруппируем полученные данные по аптекам и лекарствам и посчитаем их суммарные продажи, чтобы отслеживать как продаются эти лекарства в разных аптеках. Проранжируем лекарства по объему продаж внутри каждой аптеки. И присоединим к этой таблице полные объемы продаж по всем лекарствам в каждой аптеке с помощью оператора «JOIN» и подзапроса внутри его. В итоговом запросе выводим поля с аптекой, лекарством, номером ранга, суммарной продажей лекарства в аптеке и рассчитаем долю продаж лекарства от общих продаж аптеки в процентах. Отсортируем данные по аптекам и рангу лекарств по продажам.

Вывод:

Общая доля продаж таких лекарств в каждой аптеке составляет как минимум четверть от всех продаж. Можно сделать вывод, что такие лекарства пользуются спросом во всех аптеках. Можно отметить, что лекарство "Аква-нормикс", среди схожих лекарств, в трех аптеках занимает последнюю позицию по продажам, что говорит о меньшей популярности среди покупателей. Остальные препараты пользуются разной популярностью в зависимости от аптек. Исходя из запроса «ТОП-3 лекарств», где «Аквафорте» занимает третье место, можно сделать вывод, что этот препарат самый популярный среди подобных лекарств.

**3 запрос – Изучить продажи в зависимости от возрастной группы.**

Решение:

Во временном табличном выражении (СТЕ) находим возраст в годах для каждого клиента, потом с помощью функции «CASE» создадим новое поле, в котором поделим всех клиентов на 6 групп в зависимости от пола и возраста. В следующем табличном выражении соединяем полученные данные с таблицей с заказами по идентификатору клиента. Сделаем группировку по полученным шести группам и посчитаем в каждой группе количество уникальных клиентов и объемы продаж. Присоединим к полученным данным всю сумму продаж по всем аптекам с помощью подзапроса в «SELECT». В итоговом запросе выводим наши группы, количество клиентов в каждой группе, объемы продаж в каждой группе и рассчитаем долю каждой группы от всех продаж в процентах. Отсортируем данные по объемам продаж.

Вывод:

Больше всего на покупки лекарств тратят мужчины и женщины за 45 лет, данные группы являются самыми многочисленными по количеству клиентов. Их суммарные покупки составляют половину продаж по всем аптекам. Относительно самыми здоровыми можно считать женщин младше 30, они тратят меньше всех на лекарства, их доля покупок составляет 10.8%. А мужчины младше 30 занимают третье место, их доля от общих продаж 13.3%.
